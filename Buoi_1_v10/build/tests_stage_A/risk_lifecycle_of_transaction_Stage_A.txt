
Giả sử bạn tạo một Transaction bằng malloc() như sau:


🧨 Trường hợp bạn viết:
Transaction* t = (Transaction*)malloc(sizeof(Transaction));
t->book = (Book*)malloc(sizeof(Book));
t->user = (User*)malloc(sizeof(User));


📊 SƠ ĐỒ 1: Transaction dùng malloc (❌ KHÔNG KHUYẾN KHÍCH TRÊN STM32)
RAM Layout:

+-------------------------------+ ← Stack cao
| Return address                |
| Previous frame pointer        |
|-------------------------------|
| t (Transaction*)              | → trỏ vào vùng heap
+-------------------------------+

             ↓
+===============================================+
| Heap                                          |
|-----------------------------------------------|
| Transaction                                   |
| ├─ id                                         |
| ├─ book (Book*) ─┐                            |
| ├─ user (User*) ─┘                            |
| └─ is_active                                  |
|                                               |
| • book → struct Book { ... } (trên heap)      |
| • user → struct User { ... } (trên heap)      |
+===============================================+
| Global/static memory                          |
| • Không sử dụng library.books/users[]         |
+===============================================+


❗ Vấn đề:
Bạn phải free(t->book); free(t->user); free(t);

Nếu quên free, → rò rỉ RAM (nguy hiểm trên STM32 vì RAM nhỏ).

Phức tạp hóa quản lý bộ nhớ → KHÔNG phù hợp cho nhúng hoặc STM32.

