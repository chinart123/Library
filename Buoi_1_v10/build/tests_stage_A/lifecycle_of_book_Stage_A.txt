âœ… DÆ°á»›i Ä‘Ã¢y lÃ  sÆ¡ Ä‘á»“ RAM báº±ng text mÃ´ phá»ng vÃ²ng Ä‘á»i cá»§a hÃ m create_book() khi báº¡n dÃ¹ng Library library; vÃ  gá»i hÃ m Ä‘á»ƒ táº¡o 1 sÃ¡ch má»›i.
Library library;
void create_book(int id, const char* title, const char* author) {
    Book* b = &library.books[book_count];
    b->id = id;
    strcpy(b->title, title);
    strcpy(b->author, author);
    b->is_deleted = false;
    add_event(EVENT_BOOK_CREATE, id, 0);
}

ğŸ“Š SÆ  Äá»’ RAM: Trong lÃºc create_book() Ä‘ang cháº¡y
+---------------------------+  â† Stack cao (gáº§n Ä‘á»‹a chá»‰ lá»›n)
| Return address            | â† Ä‘á»‹a chá»‰ quay láº¡i sau khi hÃ m káº¿t thÃºc
| Previous frame pointer    |
|---------------------------|
| create_book() stack frame |
|---------------------------|
| id                        | â† (int) tham sá»‘
| title                     | â† (const char*) tham sá»‘ â†’ trá» Ä‘áº¿n flash
| author                    | â† (const char*) tham sá»‘ â†’ trá» Ä‘áº¿n flash
| b (Book*)                 | â† trá» vÃ o library.books[book_count]
+---------------------------+
| CÃ¡c biáº¿n táº¡m khÃ¡c         |
+---------------------------+  â† Stack tháº¥p dáº§n
        ...
        ...
+===========================+
| Global/static memory      |
|---------------------------|
| Library library;          | â† 5880 bytes RAM
|  - books[20]              |
|     - id                  |
|     - title[100]          |
|     - author[100]         |
|     - is_deleted          |
|  - users[10]              |
|  - transactions[20]       |
+---------------------------+
| Event timeline[100]       | â† ghi láº¡i event BOOK_CREATE
+===========================+
        ...
+---------------------------+
| .data/.bss segment        |
| (biáº¿n toÃ n cá»¥c khÃ¡c)      |
+---------------------------+
| Heap (náº¿u dÃ¹ng malloc)    | âŒ KhÃ´ng dÃ¹ng
+---------------------------+


âœ… Sau khi create_book() káº¿t thÃºc:
Stack frame cá»§a create_book() bá»‹ xÃ³a

Dá»¯ liá»‡u sÃ¡ch váº«n cÃ²n trong library.books[]

Event váº«n cÃ²n trong timeline[]

ğŸ¯ Káº¿t luáº­n:
Báº¡n khÃ´ng máº¥t dá»¯ liá»‡u, vÃ¬ thÃ´ng tin Ä‘Æ°á»£c sao chÃ©p vÃ o vÃ¹ng nhá»› tÄ©nh

KhÃ´ng cÃ³ váº¥n Ä‘á» gÃ¬ vá»›i stack trá»« khi báº¡n táº¡o quÃ¡ nhiá»u biáº¿n cá»¥c bá»™ lá»›n

KhÃ´ng cáº§n heap náº¿u khÃ´ng dÃ¹ng malloc


ğŸ¯ TÃ³m táº¯t
| TÃ¬nh huá»‘ng        | DÃ¹ng tá»‘t á»Ÿ Ä‘Ã¢u?                               |
| ----------------- | --------------------------------------------- |
| Dá»¯ liá»‡u tÄ©nh      | ğŸŸ¢ STM32, nhÃºng nÃ³i chung                     |
| malloc + free     | ğŸŸ¡ TrÃªn PC, hoáº·c há»‡ thá»‘ng lá»›n                 |
| malloc khÃ´ng free | ğŸ”´ GÃ¢y rÃ² rá»‰ bá»™ nhá»›, ráº¥t nguy hiá»ƒm trÃªn STM32 |


âœ… ÄÃºng rá»“i â€” cÃ¡c Ä‘á»‘i tÆ°á»£ng nhÆ° User, Transaction, Timeline, Library cÅ©ng nÃªn theo mindset giá»‘ng nhÆ° Book:

KhÃ´ng nÃªn dÃ¹ng malloc()

NÃªn dÃ¹ng máº£ng tÄ©nh Ä‘Ã£ khai bÃ¡o sáºµn trong Library

TrÃ¡nh cáº¥p phÃ¡t Ä‘á»™ng náº¿u khÃ´ng thá»±c sá»± cáº§n

VÃ²ng Ä‘á»i vÃ  vá»‹ trÃ­ dá»¯ liá»‡u pháº£i rÃµ rÃ ng (dá»… debug, tá»‘i Æ°u RAM)

ğŸ‘‰ ÄÃ¢y lÃ  chiáº¿n lÆ°á»£c tá»‘t nháº¥t cho STM32 hoáº·c báº¥t ká»³ há»‡ thá»‘ng nhÃºng RAM tháº¥p nÃ o